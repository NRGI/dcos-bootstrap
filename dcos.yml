- hosts: localhost
  connection: local
  gather_facts: False
  tasks:
    - name: Create EC2 key pair
      ec2_key:
        name: dcos_admin
        state: present
        region: "{{ aws_region }}"
        key_material: "{{ item }}"
      with_file: dcos_public_key

    - name: Create Mesosphere DCOS cluster
      cloudformation:
        stack_name: dcos
        state: present
        region: "{{ aws_region }}"
        template_url: https://s3.amazonaws.com/downloads.mesosphere.io/dcos/stable/cloudformation/single-master.cloudformation.json
        template_parameters:
          AcceptEULA: "Yes"
          AdminLocation: 0.0.0.0/0
          KeyName: dcos_admin
          PublicSlaveInstanceCount: 1
          SlaveInstanceCount: 3
      register: dcos_stack
