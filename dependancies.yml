- hosts: localhost
  connection: local
  gather_facts: False
  tasks:
    - name: Get list of installed DCOS packages
      command: ./dcos package list
      register: package_list
      ignore_errors: True
    - name: Get list of installed Marathon aps
      command: ./dcos marathon app list
      register: app_list
      ignore_errors: True

    - name: Install chronos
      command: ./dcos package install --yes chronos
      when: "'/chronos' not in package_list.stdout"

    - name: Install marathon-lb-external
      command: ./dcos package install --yes --options=./conf/marathon-lb-opt.json marathon-lb
      when: "'/marathon-lb-external' not in package_list.stdout"

    # - name: Install RGI staging
    #   command: ./dcos marathon app add ./conf/rgi-staging.json
    #   when: "'/rgi-staging' not in app_list.stdout"

    - name: Install RGI production
      command: ./dcos marathon app add ./conf/rgi-production.json
      when: "'/rgi-production' not in app_list.stdout"

    # - name: Install RP staging
    #   command: ./dcos marathon app add ./conf/rp-staging.json
    #   when: "'/rp-staging' not in app_list.stdout"

    - name: Install RP production
      command: ./dcos marathon app add ./conf/rp-production.json
      when: "'/rp-production' not in app_list.stdout"